var g=require("path"),h=require("react"),$=require("node:fs/promises"),w=require("react-dom/server"),{renderToString:D}=w,{readFile:y,writeFile:E,cp:P,readdir:x}=$,p={DEV:"development",PROD:"production"},I=process.env.NODE_ENV||p.DEV,d=process.cwd(),f=e=>typeof e=="string"&&e.length>0,N=e=>{let t=g.basename(e,g.extname(e)),n=t.substring(0,t.indexOf(".static"));return`${n.slice(0,1).toLowerCase()}${n.slice(1)}`},O=e=>{let t=require(e);return t.default&&(t=t.default),D(h.createElement(t,null))},R=(e,t,n)=>{let o=t.indexOf(n)+n.length+2,a=t.substring(0,o),s=t.substring(o);return`${a}${e}${s}`},q=async(e,t,n)=>{try{let o=R(e,t.content,n);await E(t.path,o)}catch(o){console.log(o.message)}};module.exports=(e={})=>{let t=f(e.outDir)?`${d}/${e.outDir}`:`${d}/out`,n=f(e.pages)?`${d}/${e.pages}`:null,o=[];return{name:"reactStaticPlugin",setup:a=>{a.onStart(async()=>{try{if(!n)throw new Error("Must specify a html page");await P(n,t,{recursive:!0});let i=(await x(n)).map(async l=>new Promise((r,c)=>{let m=`${t}/${l}`;y(m,"utf8").then(u=>{u||c(`Can't read file ${l}`),r({path:m,content:u})}).catch(u=>c(u))}));o=await Promise.all(i)}catch(s){console.log(s.message)}}),a.onLoad({filter:/\.static.jsx$/},async s=>{let i=s.path,l=O(i),r=N(i);return I===p.PROD&&o.forEach(async c=>{c.content.includes(`id="${r}"`)&&(console.log("component:",r),console.log("injected in:",c.path),console.log("---------------------------"),console.log("---------------------------"),await q(l,c,r))}),{loader:"jsx"}})}}};