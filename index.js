var f=require("path"),h=require("react"),p=require("node:fs/promises"),$=require("react-dom/server"),{renderToString:w}=$,{readFile:x,writeFile:y,cp:C,readdir:I}=p,g=process.cwd(),m=t=>typeof t=="string"&&t.length>0,q=t=>{let e=f.basename(t,f.extname(t)),o=e.substring(0,e.indexOf(".static"));return`${o.slice(0,1).toLowerCase()}${o.slice(1)}`},D=t=>{let e=require(t);return e.default&&(e=e.default),w(h.createElement(e,null))},F=(t,e,o)=>{let s=e.indexOf(o)+o.length+2,a=e.substring(0,s),n=e.substring(s);return`${a}${t}${n}`};module.exports=(t={})=>{let e=m(t.outDir)?`${g}/${t.outDir}`:`${g}/out`,o=m(t.pages)?`${g}/${t.pages}`:null,s=[];return{name:"reactStaticPlugin",setup:a=>{a.onStart(async()=>{try{if(!o)throw new Error("Must specify a html page");await C(o,e,{recursive:!0});let r=(await I(o)).map(async l=>new Promise((i,c)=>{let d=`${e}/${l}`;x(d,"utf8").then(u=>{u||c(`Can't read file ${l}`),i({path:d,content:u})}).catch(u=>c(u))}));s=await Promise.all(r)}catch(n){console.log(n.message)}}),a.onLoad({filter:/\.static.jsx$/},n=>{let r=n.path,l=D(r),i=q(r);return s.forEach(c=>{c.content.includes(`id="${i}"`)&&(console.log("Component:",i),console.log("Injected in:",c.path),console.log("-------------------------------------------"),console.log("-------------------------------------------"),c.content=F(l,c.content,i))}),{loader:"jsx"}}),a.onEnd(async()=>{for(let n=0;n<s.length;n++){let r=s[n];await y(r.path,r.content)}})}}};